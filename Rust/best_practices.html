<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

        <!-- MathJax -->
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./using-the-wiki.html"><strong>1.</strong> Using this Document</a></li><li><a href="./new-projects.html"><strong>2.</strong> Checklist For New Projects</a></li><li><a href="./JavaScript/javascript.html"><strong>3.</strong> JavaScript</a></li><li><a href="./docker-images.html"><strong>4.</strong> Docker</a></li><li><a href="./Python/index.html"><strong>5.</strong> Python</a></li><li><ul class="section"><li><a href="./Python/sqlalchemy.html"><strong>5.1.</strong> SqlAlchemy</a></li></ul></li><li><a href="./basic-server-setup.html"><strong>6.</strong> Basic Server Setup</a></li><li><a href="./Rust/index.html"><strong>7.</strong> Rust</a></li><li><ul class="section"><li><a href="./Rust/rust_interop.html"><strong>7.1.</strong> Using Rust outside Rust</a></li><li><a href="./Rust/emails_and_templates.html"><strong>7.2.</strong> Emails and Templates</a></li><li><a href="./Rust/best_practices.html" class="active"><strong>7.3.</strong> Best Practices</a></li></ul></li><li><a href="./testing_in_c.html"><strong>8.</strong> Testing In C</a></li><li><a href="./latex.html"><strong>9.</strong> LaTeX Snippets</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                <div id="content" class="content">
                    <h1>Best Practices</h1>
<p>Here's a bunch of best practices and design patterns I've discovered in my time
writing Rust code.</p>
<p>A lot of these points come from <a href="https://pascalhertleif.de/artikel/good-practices-for-writing-rust-libraries/">this awesome article</a>, so I'd
recommend checking that out too.</p>
<h2>Quick Links</h2>
<p>For those too lazy to scroll:</p>
<ul>
<li><a href="Rust/best_practices.html#Format%20Your%20Code">Format Your Code</a></li>
<li><a href="Rust/best_practices.html#Document%20All%20the%20Things!">Document All The Things!</a></li>
<li><a href="Rust/best_practices.html#Add%20Even%20More%20Lints">Add Even More Lints</a></li>
<li><a href="Rust/best_practices.html#Miscellaneous%20Tips">Miscellaneous Tips</a></li>
</ul>
<h2>Format Your Code</h2>
<p>It's always nice to have your code formatted correctly and when everyone follows
a common coding standard, it's even nicer when your computer can enforce all
this for you. You should probably use <a href="https://github.com/rust-lang-nursery/rustfmt">rustfmt</a> for this...</p>
<pre><code>$ cargo install rustfmt
</code></pre>
<p>By default, this also installs a <code>fmt</code> sub-command for use with <code>cargo</code>, so now
you can reformat your entire library with a simple <code>cargo fmt</code> call.</p>
<p>If you're using the <code>Atom</code> editor and have <code>rustfmt</code> installed then it can run
<code>rustfmt</code> every time you hit save using <a href="https://atom.io/packages/atom-beautify">atom-beautify</a>.</p>
<pre><code>$ apm install atom-beautify
</code></pre>
<p>To configure <code>rustfmt</code>, just drop a file called <code>rustfmt.toml</code> (or
<code>.rustfmt.toml</code> if you want) with a bunch of configuration options. You can get
the list of valid configuration options from rustfmt itself.</p>
<pre><code>rustfmt --config-help
</code></pre>
<p>This is what my usual <code>.rustfmt.toml</code> looks like:</p>
<pre><code>$ cat .rustfmt.toml
format_strings = false
reorder_imports = true
take_source_hints = false
report_todo = &quot;Always&quot;
report_fixme = &quot;Always&quot;
</code></pre>
<h2>Document All the Things!</h2>
<p>It's always nice when you can flick through a crate's documentation and tell
straight away how to use it and what everything does. Therefore as a bare
minimum you should make sure that <strong>all</strong> exported functions, structs, and enums
have at least a line or two describing what they do.</p>
<p>To enforce this, you can add a lint to your root <code>lib.rs</code> to prevent any changes
which add undocumented public interfaces.</p>
<pre><code>#![deny(missing_docs)]
</code></pre>
<p>Next up, for any major function or struct, make sure you add a couple of
examples in the doc comment. These are also compiled and run when you run your
test suite (you do have tests, don't you?) so it's easy to keep them up to date.</p>
<pre><code>/// (summary line here)
///
/// some more info about the function...
///
/// # Examples
///
/// ```
/// let src = &quot;(print 1 2)&quot;;
/// let ast = parse(src).unwrap();
/// ```
</code></pre>
<h2>Add Even More Lints</h2>
<p>You can get the compiler to do even more checking for you by simply adding a
couple extra lints to your crate.</p>
<pre><code>#![deny(missing_copy_implementations,
    missing_debug_implementations,
    missing_docs,
    trivial_casts,
    trivial_numeric_casts,
    unsafe_code,
    unstable_features,
    unused_import_braces,
    unused_qualifications,
    unused_extern_crates,
    unused_results,
    variant_size_differences)]
</code></pre>
<h2>Continuous Integration</h2>
<p>If you use GitHub for storing your code then adding CI is a fairly trivial thing
to do. Here's a detailed example <code>.travis.yml</code> which will automatically test
your library on all three channels of the rust compiler, then generate and
upload your crate's documentation to <a href="https://pages.github.com/">GitHub Pages</a>.</p>
<pre><code>$ cat .travis.yml
sudo: false
language: rust
rust:
- nightly
- beta
- stable
matrix:
allow_failures:
- rust: nightly
before_script:
- |
pip install 'travis-cargo&lt;0.2' --user &amp;&amp;
export PATH=$HOME/.local/bin:$PATH
script:
- |
travis-cargo build &amp;&amp;
travis-cargo test &amp;&amp;
travis-cargo bench &amp;&amp;
travis-cargo --only stable doc
after_success:
- travis-cargo --only stable doc-upload
env:
global:
- TRAVIS_CARGO_NIGHTLY_FEATURE=dev
- secure: # encrypted stuff
</code></pre>
<p>To enable the auto­matic doc­u­men­ta­tion uploads (i.e. push­ing rust­doc's out­put to
the pro­jec­t's <code>gh-pages</code> branch) sup­ported by <code>travis-cargo</code>, you need to add an
envi­ron­ment vari­able called <code>GH_TOKEN</code> that con­tains an access token for your
GitHub account (encrypted and with lim­ited rights). You can cre­ate one
<a href="https://github.com/settings/tokens">here</a>.</p>
<p>To encrypt the token, you can use <a href="https://github.com/travis-ci/travis.rb">Trav­is' CLI tool</a> (installed with
<code>gem install travis</code>) by run­ning this in your pro­jec­t's root direc­tory
(replace &quot;1234&quot; with your token):</p>
<pre><code>$ travis encrypt &quot;GH_TOKEN=1234&quot; --add env.global
</code></pre>
<p>When every­thing is set up cor­rectly, you should be able to view your pro­jec­t's
doc­u­men­ta­tion at <code>https://$USERNAME.github.io/$PROJECT</code>.</p>
<h2>Error Handling</h2>
<p>For non-trivial crates where you may have several common error cases, you might
want to define your own error type. This type can then implement
[std::convert::From][from] for all the errors you may be wrapping. That way the
error integrates nicely with the <code>try!()</code> macro and your entire library will
be simplified by using only one error and <code>Result</code> type.</p>
<pre><code class="language-rust">use std::io;
use std::num;

pub type CliResult&lt;T&gt; = Result&lt;T, CliError&gt;;

#[derive(Debug)]
enum CliError {
  Io(io::Error),
  Parse(num::ParseIntError),
}

impl From&lt;io::Error&gt; for CliError {
  fn from(err: io::Error) -&gt; CliError {
    CliError::Io(err)
  }
}

...
</code></pre>
<p>You should also make sure your custom error implements the <code>std::error::Error</code>
trait.</p>
<pre><code class="language-rust">impl Error for CliError {
  fn description(&amp;self) -&gt; &amp;str {
    match *self {
      CliError::Io(ref err) =&gt; err.description(),
      CliError::Csv(ref err) =&gt; err.description(),
    }
  }

  fn cause(&amp;self) -&gt; Option&lt;&amp;Error&gt; {
    ...
  }
}
</code></pre>
<h2>Miscellaneous Tips</h2>
<ul>
<li>Don't dupli­cate your bina­ry's ver­sion num­ber in your code. Use
<code>env!(&quot;CARGO_PKG_VERSION&quot;)</code> to get the ver­sion you set in <code>Cargo.toml</code> at
com­pile time.</li>
<li>Write com­mit mes­sages in a <a href="https://github.com/ajoslin/conventional-changelog/blob/4bf7d8df29f7be29552b82ec2b7112fad0c39a3e/conventions/angular.md">“con­ven­tional”</a> style and use
<a href="https://github.com/clog-tool/clog-cli">Clog</a> to auto­mat­i­cally gen­er­ate change logs.</li>
<li>Install more <a href="https://github.com/rust-lang/cargo/wiki/Third-party-cargo-subcommands">Cargo Sub­com­mands</a>!</li>
<li>Make sure that all you test each feature of your code (note &quot;unit&quot; in &quot;unit
test&quot; doesn't necessarily mean each and every little function).</li>
<li>Integration tests are awesome too.</li>
</ul>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a href="./Rust/emails_and_templates.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="./testing_in_c.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./Rust/emails_and_templates.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./testing_in_c.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
