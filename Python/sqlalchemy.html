<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

        <!-- MathJax -->
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./using-the-wiki.html"><strong>1.</strong> Using this Document</a></li><li><a href="./new-projects.html"><strong>2.</strong> Checklist For New Projects</a></li><li><a href="./JavaScript/javascript.html"><strong>3.</strong> JavaScript</a></li><li><a href="./docker-images.html"><strong>4.</strong> Docker</a></li><li><a href="./Python/index.html"><strong>5.</strong> Python</a></li><li><ul class="section"><li><a href="./Python/sqlalchemy.html" class="active"><strong>5.1.</strong> SqlAlchemy</a></li></ul></li><li><a href="./basic-server-setup.html"><strong>6.</strong> Basic Server Setup</a></li><li><a href="./Rust/index.html"><strong>7.</strong> Rust</a></li><li><ul class="section"><li><a href="./Rust/rust_interop.html"><strong>7.1.</strong> Using Rust outside Rust</a></li><li><a href="./Rust/emails_and_templates.html"><strong>7.2.</strong> Emails and Templates</a></li><li><a href="./Rust/best_practices.html"><strong>7.3.</strong> Best Practices</a></li></ul></li><li><a href="./testing_in_c.html"><strong>8.</strong> Testing In C</a></li><li><a href="./latex.html"><strong>9.</strong> LaTeX Snippets</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                <div id="content" class="content">
                    <h1>SqlAlchemy Basics</h1>
<h2>Engines and Sessions</h2>
<p>The docs for <a href="http://docs.sqlalchemy.org/en/latest/core/engines.html#database-urls">engines</a> and <a href="http://docs.sqlalchemy.org/en/latest/orm/session_basics.html#session-basics">sessions</a>.</p>
<p>You can create a basic sqlite engine.</p>
<pre><code class="language-python">    from sqlalchemy import create_engine
    engine = create_engine('sqlite:///:memory:')
</code></pre>
<p>Or for something more advanced...</p>
<p>Given:</p>
<ul>
<li>user: scott</li>
<li>password: tiger</li>
<li>host: localhost</li>
<li>database: test</li>
</ul>
<p>The equivalent URI would be:</p>
<pre><code class="language-python">    engine = create_engine(&quot;postgresql://scott:tiger@localhost/test&quot;)
    engine = create_engine(&quot;mysql://scott:tiger@hostname/test&quot;,
                                encoding='latin1', echo=True)
</code></pre>
<p>To interact with the engine you need to use a session. You can create a session
using a sessionmaker.</p>
<pre><code class="language-python">    from sqlalchemy.orm import sessionmaker
    Session = sessionmaker(bind=engine)

    some_session = Session()
</code></pre>
<h2>Models</h2>
<p><a href="http://docs.sqlalchemy.org/en/latest/orm/tutorial.html#declare-a-mapping">The Docs</a></p>
<p>An example of a basic model...</p>
<pre><code class="language-python">    from sqlalchemy.ext.declarative import declarative_base
    from sqlalchemy import Column, Integer, String

    Base = declarative_base()

    class User(Base):
        __tablename__ = 'users'

        id = Column(Integer, primary_key=True)
        name = Column(String)
        fullname = Column(String)
        password = Column(String)

        def __repr__(self):
        return &quot;&lt;User(name='%s', fullname='%s', password='%s')&gt;&quot; % (
                                self.name, self.fullname, self.password)
</code></pre>
<p>It's pretty easy to create the tables that correspond to your models.</p>
<pre><code class="language-python">    Base.metadata.create_all(engine)
</code></pre>
<p>Dropping all tables and data is just as simple.</p>
<pre><code class="language-python">    Base.metadata.drop_all(engine)
</code></pre>
<h2>Creating Data</h2>
<p><a href="http://docs.sqlalchemy.org/en/latest/orm/tutorial.html#adding-and-updating-objects">The Docs</a>
Once you have a session and have defined some models, you can create instances
of that model.</p>
<pre><code class="language-python">    ed_user = User(name='ed', fullname='Ed Jones', password='edspassword')
</code></pre>
<p>You can then stage the instance to your session (similar to how you stage
changes before committing them with <code>git</code>).</p>
<pre><code class="language-python">    session.add(ed_user)
</code></pre>
<p>You can then commit everything in one hit.</p>
<pre><code class="language-python">    session.commit()
</code></pre>
<p>Or roll back, if you don't want to save your changes.</p>
<pre><code class="language-python">    session.rollback()
</code></pre>
<h2>Making Queries</h2>
<p><a href="http://docs.sqlalchemy.org/en/latest/orm/query.html#query-api">The Docs</a></p>
<h2>Many-to-Many Relationships</h2>
<p>This can be a tricky topic, so make sure to read <a href="http://docs.sqlalchemy.org/en/latest/orm/basic_relationships.html#many-to-many">the docs</a>!</p>
<p>Many to Many adds an association table between two classes. The association
table is indicated by the secondary argument to relationship(). Usually, the
Table uses the MetaData object associated with the declarative base class, so
that the ForeignKey directives can locate the remote tables with which to link.</p>
<pre><code class="language-python">    from sqlalchemy import Table, Column, Integer, ForeignKey
    from sqlalchemy.orm import relationship
    from sqlalchemy.ext.declarative import declarative_base

    association_table = Table('association', Base.metadata,
        Column('left_id', Integer, ForeignKey('left.id')),
        Column('right_id', Integer, ForeignKey('right.id')))
</code></pre>
<p>Now to link the two classes, you need to declare a <code>relationship</code> attribute.
The <code>secondary</code> argument specifies the association table used. The
<code>back_populates</code> argument tells SqlAlchemy which column to link with when it
joins the two tables. It allows you to access the linked records as a list
with something like <code>Parent.children</code>.</p>
<pre><code class="language-python">    class Parent(Base):
        __tablename__ = 'left'
        id = Column(Integer, primary_key=True)
        children = relationship(
            &quot;Child&quot;,
            secondary=association_table,
            back_populates=&quot;parents&quot;)

    class Child(Base):
        __tablename__ = 'right'
        id = Column(Integer, primary_key=True)
        parents = relationship(
            &quot;Parent&quot;,
            secondary=association_table,
            back_populates=&quot;children&quot;)
</code></pre>
<p>Alternatively, you can use the <code>backref</code> argument when specifying the
<code>relationship</code> for one class, this creates a virtual column in the
corresponding class that links back to the first one.</p>
<pre><code class="language-python">    class Parent(Base):
        __tablename__ = 'left'
        id = Column(Integer, primary_key=True)
        children = relationship(&quot;Child&quot;,
                        secondary=association_table,
                        backref=&quot;parents&quot;)

    class Child(Base):
        __tablename__ = 'right'
        id = Column(Integer, primary_key=True)
</code></pre>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a href="./Python/index.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="./basic-server-setup.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./Python/index.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./basic-server-setup.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
